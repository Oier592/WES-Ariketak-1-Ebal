<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP Fetch adibidea</title>
</head>

<body>

    <!-- GET: Taldeak -->
    <button id="datuakBistaratu">GET Taldeak</button>
    <p></p>

    <!-- GET Taldeak ID -->
    <input type="number" id="getIdInput" placeholder="Get Taldeak ID" />
    <button id="getByIdBtn">Get Taldeak ID</button>
    <p></p>

    <!-- POST: Taldea -->
    <input type="text" id="postIzena" placeholder="Izena" />
    <input type="number" id="postPuntuak" placeholder="Puntuak" />
    <button id="taldea_Insert">POST taldea</button>
    <p></p>

    <!-- PUT: Taldeak Puntuak -->
    <input type="number" id="putId" placeholder="ID" />
    <input type="number" id="putPuntuak" placeholder="Update puntuak" />
    <button id="puntuak_Update">PUT puntuak</button>
    <p></p>

    <!-- DELETE: Taldeak -->
    <input type="number" id="deleteId" placeholder="ID" />
    <button id="taldea_Delete">DELETE taldea</button>
    <p></p>

    <div id="emaitza">
    </div>

    <script>
        const url = 'taldeak-api.php';
        const emaitzaDiv = document.getElementById('emaitza');

        // --- GET Taldeak ---
        function eskuratuDatuak() {
            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('Errore bat gertatu da.');
                    return response.json();
                })
                .then(data => {
                    emaitzaDiv.innerHTML = '';
                    data.forEach(registro => {
                        const p = document.createElement('p');
                        p.textContent = `ID: ${registro.id}, Izena: ${registro.izena}, Puntuak: ${registro.puntuak}`;
                        emaitzaDiv.appendChild(p);
                    });
                })
                .catch(error => console.error('Error:', error));
        }

        // --- GET Taldea (ID) ---
        function getById() {
            const id = document.getElementById('getIdInput').value;

            fetch(`${url}?id=${id}`)
                .then(res => res.json())
                .then(data => {
                    emaitzaDiv.innerHTML = '';

                    const equipo = document.createElement('p');
                    equipo.textContent = `ID: ${data.id}, Izena: ${data.izena}, Puntuak: ${data.puntuak}`;
                    emaitzaDiv.appendChild(equipo);

                    if (data.partaideak && data.partaideak.length > 0) {
                        const lista = document.createElement('ul');
                        data.partaideak.forEach(p => {
                            const li = document.createElement('li');
                            li.textContent = `ID: ${p.id}, Izena: ${p.izena}, Herrialdea: ${p.herrialdea}`;
                            lista.appendChild(li);
                        });
                        emaitzaDiv.appendChild(lista);
                    } else {
                        const mensaje = document.createElement('p');
                        mensaje.textContent = 'Ez dago partaiderik';
                        emaitzaDiv.appendChild(mensaje);
                    }
                })
                .catch(error => console.error('Error:', error));
        }


        // --- POST: Taldea ---
        function taldea_Sortu() {
            const izena = document.getElementById('postIzena').value;
            const puntuak = parseInt(document.getElementById('postPuntuak').value);

            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ izena, puntuak })
            })
                .then(res => res.json())
                .then(data => {
                    emaitzaDiv.innerHTML = JSON.stringify(data, null, 2);
                })
                .catch(error => console.error('Error:', error));
        }

        // --- PUT: Taldea Puntuak ---
        function puntuak_Eguneratu() {
            const id = parseInt(document.getElementById('putId').value);
            const puntuak = parseInt(document.getElementById('putPuntuak').value);

            fetch(url, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id, puntuak })
            })
                .then(res => res.json())
                .then(data => {
                    emaitzaDiv.innerHTML = JSON.stringify(data, null, 2);
                })
                .catch(error => console.error('Error:', error));
        }

        // --- DELETE ---
        function taldea_Delete() {
            const id = parseInt(document.getElementById('deleteId').value);

            fetch(`${url}?id=${id}`, { method: 'DELETE' })
                .then(res => res.json())
                .then(data => {
                    emaitzaDiv.innerHTML = JSON.stringify(data, null, 2);
                })
                .catch(error => console.error('Error:', error));
        }

        document.getElementById('datuakBistaratu').addEventListener('click', eskuratuDatuak);
        document.getElementById('getByIdBtn').addEventListener('click', getById);
        document.getElementById('taldea_Insert').addEventListener('click', taldea_Sortu);
        document.getElementById('puntuak_Update').addEventListener('click', puntuak_Eguneratu);
        document.getElementById('taldea_Delete').addEventListener('click', taldea_Delete);
    </script>

</body>

</html>